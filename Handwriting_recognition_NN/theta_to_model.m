function ret = theta_to_model(theta)
    % This function takes a model (or gradient) in the form of one long vector (maybe produced by model_to_theta), and restores it to the structure format, i.e. with fields .input_to_hid and .hid_to_class, both matrices.
    n_hid = size(theta, 1) / (256+10);
    ret.input_to_hid = transpose(reshape(theta(1: 256*n_hid), 256, n_hid));
    ret.hid_to_class = reshape(theta(256 * n_hid + 1 : size(theta,1)), n_hid, 10).';
end